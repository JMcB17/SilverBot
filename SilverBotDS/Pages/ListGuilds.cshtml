@page "/listguilds"
@using System.Net
@using System.Text
@using System.IO
@using Microsoft.AspNetCore.Http
@using SilverBotDS.Objects
@using DSharpPlus
@using System.Diagnostics
@using SilverBotDS.WebHelpers
@using SilverBotDS
@using Microsoft.JSInterop
@inject Config config
@inject IHttpContextAccessor HttpContextAccessor
@inject DiscordClient Discord
@inject IJSRuntime jsRuntime
@{

    if (string.IsNullOrEmpty(SessionHelper.GetObjectFromJson<string>(HttpContextAccessor.HttpContext.Session, "accessToken")))
    {
        Response.Redirect($"https://{Request.Host}/login");
    }
    else
    {

        var thing = SessionHelper.GetUserInfoFromSession(HttpContextAccessor.HttpContext.Session);
        ViewBag.message = $"Hello {thing.Username}#{thing.Discriminator}!";
        StringBuilder html_shit = new("<table><tr>");
        int epicness = 0;
        var servers = from server in SessionHelper.GetGuildsFromSession(HttpContextAccessor.HttpContext.Session) where Discord.Guilds.ContainsKey(server.UId) && ((Discord.Guilds[server.UId].GetMemberAsync(thing.UId).GetAwaiter().GetResult()).Roles.Any(e => e.CheckPermission(Permissions.ManageGuild) == PermissionLevel.Allowed) || server.Owner) select server;
        foreach (var server in servers)
        {
            if (epicness > 6)
            {
                epicness = 0;
                html_shit.Append("</tr><tr>");
            }
            html_shit.Append($"<td style =\"max-width:150px; max-height:150px;\"><a onclick=\"alert('id is {server.Id}')\">");
            if (string.IsNullOrEmpty(server.Icon))
            {
                var split_name = server.Name.Split(' ');
                StringBuilder sb = new StringBuilder();
                foreach (string s in split_name)
                {
                    sb.Append(s[0]);
                }
                html_shit.Append($"<div style=\"text-align:center; width: 100px; height: 100px; border: 1px solid #000; background-color: #000; display: flex; justify-content: center; align-items: center;\"><p style=\"color:white; font-size: 30px; font-family: Whitney,Helvetica Neue,Helvetica,Arial,sans-serif;\">{sb.ToString()}</p></div>");
            }
            else
            {
                html_shit.Append($"<img height=\"100\" width=\"100\" src=\"https://cdn.discordapp.com/icons/{server.Id}/{server.Icon}.png\" alt=\"{server.Name}'s image\">");
            }
            html_shit.Append($"<p>{server.Name}</p></a></td>");
            epicness++;
        }
        html_shit.Append("</tr></table>");
        ViewBag.Table = html_shit.ToString();

    } }
<h1>@ViewBag.message</h1>
@Html.Raw(ViewBag.Table)